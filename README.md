# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/types/components/— папка с интерфесами/типами для компонентов
- src/types/components/base — папка с базовыми типами
- src/types/components/model — папка с типами для части моделей
- src/types/components/view — папка с типами для части view

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
---

### **Архитектура проекта**

Проект реализован с использованием **архитектуры MVC (Model-View-Controller)**, где:
- **Model** отвечает за данные и бизнес-логику.
- **View** отвечает за отображение данных пользователю.
- **Controller** управляет взаимодействием между Model и View.

---

### **Разделение компонентов по слоям**

#### **1. Слой Model**
Этот слой отвечает за хранение и обработку данных. Основные классы и интерфейсы:

- **`AppState`**:
  - **Описание**: Центральная модель приложения, которая хранит все данные: список товаров, корзину, контакты, информацию о заказе и текущее состояние модальных окон.
  - **Поля**:
    - `products`: `Map<string, Product>` – карта товаров, загруженных с сервера.
    - `cart`: `BasketItem[]` – массив товаров в корзине.
    - `cartTotal`: `number` – общая стоимость товаров в корзине.
    - `address`: `BillingInfo` – информация о способе оплаты и адресе доставки.
    - `contacts`: `Contacts` – контактные данные пользователя.
    - `order`: `Order` – информация о текущем заказе.
    - `openedModal`: `AppStateModals` – текущее открытое модальное окно.
  - **Методы**:
    - `loadProducts()`: Загружает список товаров с сервера.
    - `loadProductDetails(id: string)`: Загружает детали конкретного товара.
    - `updateBillingInfo(billingInfo: Partial<BillingInfo>)`: Обновляет информацию о способе оплаты и адресе.
    - `updateContacts(contacts: Partial<Contacts>)`: Обновляет контактные данные.
    - `isValidBillingInfo()`: Проверяет корректность данных о способе оплаты и адресе.
    - `isValidContacts()`: Проверяет корректность контактных данных.
    - `createOrder()`: Создает заказ на основе данных из корзины и отправляет его на сервер.
    - `addToCart(product: Product)`: Добавляет товар в корзину.
    - `removeFromCart(id: string)`: Удаляет товар из корзины.
    - `getCartItems(): Product[]`: Возвращает массив товаров в корзине на текущий момент.
    - `openModal(modal: AppStateModals)`: Открывает указанное модальное окно.
    - `clearData()`: Очищает все пользовательские данные (корзина, контакты и т.д.).
  - **События**:
    - `onChange(changed: AppStateChanges)`: Уведомляет подписчиков об изменении состояния (например, добавление товара в корзину или открытие модального окна).

- **`IProductAPI`**:
  - **Описание**: Интерфейс для работы с API. Определяет методы для получения списка товаров, информации о конкретном товаре и создания заказа.
  - **Методы**:
    - `getProductList()`: Возвращает список всех товаров.
    - `getProductById(id: string)`: Возвращает информацию о конкретном товаре.
    - `createOrder(order: Order)`: Создает заказ на сервере.

---

#### **2. Слой View**
Этот слой отвечает за отображение данных пользователю. Все представления реализуют интерфейс `IView`.

- **`Main`**:
  - **Описание**: Главная страница, отображающая список товаров.
  - **Поля**:
    - `counter`: Количество товаров в каталоге.
    - `cartButton`: CSS селектор кнопки корзины.
    - `cartContent`: HTML элемент, который будет добавлять в себя список айтемов, которые передадут.
  - **Методы**:
    - `onOpenCart()`: Открывает корзину.
    - `renderItems()`: Функция для рендеринга предметов.

- **`Card`**:
  - **Описание**: Карточка товара, используемая для отображения товара в каталоге или корзине.
  - **Поля**:
    - `id`, `title`, `category`, `price`, `image`: Данные о товаре.
    - `delete`: Кнопка удаления товара (используется в корзине).
    - `compactClass`: CSS-класс для компактного отображения.
    - `isCompact`: Флаг, указывающий, нужно ли отображать карточку в компактном виде.
  - **Методы**:
    - `onClick(event: MouseEvent)`: Обрабатывает открытие товара в модальном окне.
    - `onOpenCard: (id: string)`: Открывает детальное отображение товара.

- **`Modal`**:
  - **Описание**: Базовый класс для модальных окон. Отображает произвольное содержимое.
  - **Поля**:
    - `content`: Содержимое модального окна.
    - `isActive`: Флаг, указывающий, открыто ли модальное окно.
    - `actions`: Кнопки действий (например, "Далее", "Закрыть").
    - `isError`: Флаг, указывающий, есть ли ошибка в полян на данных момент.
    - `message`: Сообщение ошибки.
    - `messageErrorClass`: Селектор класса ошибки.
  - **Методы**:
    - `onOpen()`: Вызывается при открытии модального окна.
    - `onClose()`: Вызывается при закрытии модального окна.

- **`BillingForm`**, **`ContactsForm`**:
  - **Описание**: Формы для ввода данных о способе оплаты, адресе доставки и контактной информации.
  - **Поля**:
    - `info`: Данные формы (например, способ оплаты и адрес).
    - `message`: Сообщение ошибки.
    - `isActive`: Флаг, указывающий, открыта ли форма.
    - `isError`: Флаг, указывающий, есть ли ошибка в форме.
  - **Методы**:
    - `onChange(data: BillingInfoData | ContactsData)`: Обрабатывает изменения в полях ввода и меняет свойство `isError`.
    - `onNext()`: Переходит к следующему шагу оформления заказа.
    - `onClose()`: Обработчик закрытия формы.

- **`Cart`**:
  - **Описание**: Корзина, отображающая список товаров и общую стоимость заказа.
  - **Поля**:
    - `products`: HTML элемент, который будет добавлять в себя список айтемов, которые передадут.
    - `total`: Общая стоимость товаров.
  - **Методы**:
    - `onClose()`: Закрывает корзину.
    - `onNext()`: Переходит к оформлению заказа.
    - `renderItems()`: Функция для рендеринга предметов.
  
- **`Success`**:
  - **Описание**: Корзина, отображающая список товаров и общую стоимость заказа.
  - **Поля**:
    - `total`: Общая стоимость товаров.
    - `isActive`: Флаг, указывающий, открыто ли модальное окно.
    - `description`: CSS селектор предложения о списании.
  - **Методы**:
    - `onClose()`: Закрывает окно успешного оформления заказа.

---

#### **3. Слой Controller**
Этот слой управляет взаимодействием между Model и View.

- **`EventEmitter`**:
  - **Описание**: Класс для управления событиями. Используется для передачи данных между Model и View.
  - **Методы**:
    - `on(eventName: string, handler: Function)`: Подписывает обработчик на событие.
    - `off(eventName: string, handler: Function)`: Удаляет обработчик события.
    - `emit(eventName: string, data?: any)`: Генерирует событие с данными.
    - `reset()`: Очищает все подписчики событий.

- **`AppStateEmitter`**:
  - **Описание**: Расширяет `EventEmitter` для работы с событиями, связанными с состоянием приложения.
  - **События**:
    - `change:products`: Изменение списка товаров.
    - `change:cart`: Изменение корзины (добавление/удаление товаров).
    - `change:modal`: Открытие или закрытие модального окна.
    - `change:order`: Создание нового заказа.

---

### **Описание событий**

События в приложении реализованы через класс `EventEmitter` и интерфейс `Emitter`. Они обеспечивают взаимодействие между моделями и представлениями. Каждое событие имеет уникальное имя и передает данные, которые могут быть использованы подписчиками для выполнения определенных действий.

---

#### **1. События изменения состояния (`AppStateChanges`)**
Эти события генерируются моделью данных `AppState` и уведомляют подписчиков об изменениях в состоянии приложения.

- **`change:products`**:
  - **Описание**: Генерируется при загрузке или обновлении списка товаров.
  - **Данные**: Массив объектов типа `Product[]`.
  - **Использование**: Используется для обновления интерфейса каталога товаров (например, компонент `Main`).

- **`change:modal`**:
  - **Описание**: Генерируется при открытии или закрытии модального окна.
  - **Данные**: Объект содержащий сообщение (`message`) и флаг ошибки (`isError`) модального окна.
  - **Использование**: Используется для передачи сообщения об ошибке в модальном окне.
  - 
- **`change:modalMessage`**:
  - **Описание**: Генерируется при изменении данных.
  - **Данные**: Объект типа `ModalChange`, содержащий предыдущее (`previous`) и текущее (`current`) состояние модального окна.
  - **Использование**: Используется для управления видимостью модальных окон.

- **`change:selectedProduct`**:
  - **Описание**: Генерируется при выборе товара для просмотра деталей.
  - **Данные**: Объект типа `Product | null`.
  - **Использование**: Используется для отображения информации о выбранном товаре в модальном окне.

- **`change:cart`**:
  - **Описание**: Генерируется при изменении содержимого корзины (добавление или удаление товаров).
  - **Данные**: Объект, содержащий общую стоимость (`total`) и список товаров (`products`) в корзине.
  - **Использование**: Используется для обновления интерфейса корзины.

- **`change:order`**:
  - **Описание**: Генерируется при создании нового заказа.
  - **Данные**: Объект типа `Contacts`, содержащий информацию о способе оплаты, адресе доставки и контактных данных.
  - **Использование**: Используется для завершения процесса оформления заказа и отображения экрана успеха.

---

#### **2. События модальных окон (`AppStateModals`)**
Эти события связаны с открытием и закрытием конкретных типов модальных окон.

- **`modal:product-preview`**:
  - **Описание**: Генерируется при открытии модального окна с деталями товара.
  - **Данные**: Отсутствуют (`never`).
  - **Использование**: Используется для отображения информации о товаре в модальном окне.

- **`modal:cart`**:
  - **Описание**: Генерируется при открытии модального окна корзины.
  - **Данные**: Отсутствуют (`never`).
  - **Использование**: Используется для отображения списка товаров в корзине.

- **`modal:payment-method`**:
  - **Описание**: Генерируется при открытии модального окна выбора способа оплаты и адреса доставки.
  - **Данные**: Отсутствуют (`never`).
  - **Использование**: Используется для отображения формы оплаты и доставки.

- **`modal:contact-info`**:
  - **Описание**: Генерируется при открытии модального окна ввода контактных данных.
  - **Данные**: Отсутствуют (`never`).
  - **Использование**: Используется для отображения формы ввода email и телефона.

- **`modal:success`**:
  - **Описание**: Генерируется при успешном оформлении заказа.
  - **Данные**: Отсутствуют (`never`).
  - **Использование**: Используется для отображения экрана успеха.

- **`modal:none`**:
  - **Описание**: Генерируется при закрытии всех модальных окон.
  - **Данные**: Отсутствуют (`never`).
  - **Использование**: Используется для очистки состояния модальных окон.

---

### **Валидация данных**

   - Проверяется корректность введенных данных (например, формат email, телефон).
   - При изменении данных в формах вызвается метод `onChange()`, если данные неверны, форма отображает сообщение об ошибке через подписку на событие `change:modalMessage`.
   - Методы `isValidBillingInfo()` и `isValidContacts()` проверяют, что все обязательные поля заполнены правильно.
